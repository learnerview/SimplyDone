name: Keep Alive

# Runs every 14 minutes — just under Render's 15-minute sleep threshold.
# Set the RENDER_APP_URL secret in your repository:
#   Repository → Settings → Secrets and variables → Actions → New repository secret
#   Name:  RENDER_APP_URL
#   Value: https://your-app-name.onrender.com
#
# The /ping endpoint is lightweight: no database query, no Redis call.
# It returns {"pong": true, "ts": "<UTC timestamp>"} immediately.

on:
  schedule:
    - cron: '*/14 * * * *'
  workflow_dispatch:            # allows manual trigger from GitHub Actions tab

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 2

    steps:
      - name: Ping Render app
        run: |
          echo "Pinging ${{ secrets.RENDER_APP_URL }}/ping ..."
          STATUS=$(curl --silent --output /dev/null --write-out "%{http_code}" \
            --max-time 30 \
            --retry 2 \
            --retry-delay 5 \
            "${{ secrets.RENDER_APP_URL }}/ping")
          echo "HTTP status: $STATUS"
          if [ "$STATUS" != "200" ]; then
            echo "Ping returned $STATUS — app may be cold-starting, that is OK."
          else
            echo "App is awake."
          fi
