spring.application.name=SimplyDone
server.port=${PORT:8080}

# --- Database ---
# DatabaseConfig.java handles Render's postgres:// URL conversion at runtime.
# If DATABASE_URL env var is set (Render/Docker), it parses and creates DataSource programmatically.
# If NOT set (local dev), falls back to H2 in-memory below.
spring.datasource.url=jdbc:h2:mem:simplydone;DB_CLOSE_DELAY=-1
spring.datasource.username=sa
spring.datasource.password=
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

# --- Redis ---
# RedisConfig.java handles REDIS_URL parsing (redis:// and rediss:// TLS) programmatically.
# No spring.data.redis.* properties needed — config reads REDIS_URL env var directly.

# --- Scheduler — Deficit Round-Robin ---
simplydone.scheduler.polling-interval-ms=1000
simplydone.scheduler.queue-prefix=simplydone:queue
simplydone.scheduler.weights.high=70
simplydone.scheduler.weights.normal=20
simplydone.scheduler.weights.low=10

# --- Rate Limiting — Sliding Window ---
simplydone.rate-limit.requests-per-minute=60
simplydone.rate-limit.window-seconds=60

# --- Retry — Exponential Backoff ---
simplydone.retry.max-attempts=3
simplydone.retry.initial-delay-seconds=5
simplydone.retry.backoff-multiplier=2.0

# --- Actuator ---
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.metrics.export.prometheus.enabled=true

# --- Jackson ---
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.default-property-inclusion=non_null

# --- Graceful Shutdown ---
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=15s

# --- Logging ---
logging.level.com.learnerview.simplydone=INFO
logging.pattern.console=%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# --- Error Handling ---
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=never
